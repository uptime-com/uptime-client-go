version: 2
project_name: upctl
before:
  hooks:
    - go mod tidy

builds:
  - id: upctl
    binary: upctl
    main: ./cmd/upctl
    goos:
      - darwin
      - linux
      - windows
    goarch:
      - amd64
      - arm64
    ignore:
      - goos: windows
        goarch: arm64
    env:
      - CGO_ENABLED=0
    flags:
      - -trimpath
    ldflags:
      [
        "-s",
        "-w",
        "-X",
        "main.version={{ .Version }}",
        "-X",
        "main.commit={{ .Commit }}",
      ]

archives:
  - id: upctl
    format: tar.gz
    wrap_in_directory: true

kos:
  - id: upctl
    build: upctl
    repository: uptimecom/upctl
    bare: true
    platforms:
      - linux/amd64
      - linux/arm64
    tags:
      - "latest"
      - "{{ .Version }}"
      - "{{ .Major }}.{{ .Minor }}{{ .Patch }}"
      - "{{ .Major }}"

checksum:
  algorithm: sha256

signs:
  - artifacts: checksum
    args:
      - "--batch"
      - "--local-user"
      - "{{ .Env.GPG_FINGERPRINT }}"
      - "--output"
      - "${signature}"
      - "--detach-sign"
      - "${artifact}"

snapshot:
  name_template: "{{ incpatch .Version }}-pre-{{ .ShortCommit }}"

release:
  prerelease: auto
